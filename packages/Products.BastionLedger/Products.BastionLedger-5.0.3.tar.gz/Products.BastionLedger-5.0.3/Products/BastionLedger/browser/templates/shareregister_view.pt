<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">

 <body>
   <div metal:fill-slot="main"
       tal:define="utool context/@@plone_portal_state/portal_url;
                   effective request/date | view/now;">

      <h1><img src="" alt="" tal:define="icon python:context.getIcon(1)"
               tal:attributes="src string:${utool}/${icon}"/>&nbsp;Share register as at <span tal:replace="python: effective.strftime('%B')"/>
          
      </h1>

      <form action="" name="date_form" id="date_form" method="post" tal:attributes="action template/getId"
            class="visualNoPrint"
            tal:define="inputvalue effective;
                        formname string:date_form;
                        show_hm python: False;
                        inputname string:date;">

          <div class="reviewHistory">
             <dl id="viewing" class="collapsible inline collapsedOnLoad">
                 <dt class="collapsibleHeader">Filter</dt>
                 <dd class="collapsibleContent" tal:define="accno query/accno | python:[]">
                     <div class="label">As At</div>
                     <div metal:use-macro="here/calendar_macros/macros/calendarDatePickerBox"/>
                     <div>
                         <input class="context" type="submit" name="form.button.Filter" value=" Go "/>
                     </div>
                     <br/>
                 </dd>
             </dl>
          </div>
      </form>

      <table summary="" width="100%" border="0" cellpadding="2" cellspacing="0">
         <tr class="row">
             <td class="field">&nbsp;</td>
             <td class="field"><label>Shareholder</label></td>
             <td class="field"><label>Share</label></td>
             <td class="field" align="right"><label>Quantity</label></td>
             <td class="field" align="right"><label>Value</label></td>
         </tr>
         <tr class="row" tal:repeat="allocation view/allocations"
             tal:attributes="class python: repeat['allocation'].odd() and 'odd' or 'even'">
             <tal:block tal:define="shareholder python: allocation[0]">
                <td class="field" valign="top">
                    <img src=""  alt="Sharholder" tal:define="icon python:shareholder.getIcon(1)" 
                                 tal:attributes="src string:${utool}/${icon}"/>
                </td>
                <td class="field" valign="top">
                    <a href="" tal:attributes="href shareholder/absolute_url"
                               tal:content="shareholder/Title"/><br/>
                    <div tal:replace="structure shareholder/formattedAddress"/>
                </td>
                <tal:defns tal:repeat="defnqty python: allocation[1]">
                   <td class="field" valign="top"
                       tal:define="defn python: defnqty[0]">
                       <a href="" tal:attributes="href defn/absolute_url"
                                  tal:content="defn/title_or_id"/>
                   </td>
                   <td class="field" align="right" valign="top"
                       tal:define="qty python: defnqty[1]" tal:content="qty"/>
                   <td class="field" align="right" valign="top"
                       tal:content="python: defnqty[0].face * defnqty[1]"/>
                </tal:defns>
             </tal:block>
         </tr>
      </table>
 
      <div tal:replace="structure provider:plone.belowcontentbody">
           Document actions (print, sendto etc)
      </div>

   </div>
 
 </body>
</html>
