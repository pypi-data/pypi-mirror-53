

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Selection &mdash; Selection Documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />


</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../docattribute.html">Selection documentation attribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../algorithms/index.html">Non-randomized algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../randomized/index.html">Randomized algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../learning/index.html">Learning selection</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">Selection documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">selection</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Selection</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/api/generated/nipy.algorithms.utils.pca.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="algorithms-utils-pca">
<h1>algorithms.utils.pca<a class="headerlink" href="#algorithms-utils-pca" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-nipy.algorithms.utils.pca">
<span id="module-algorithms-utils-pca"></span><h2>Module: <code class="xref py py-mod docutils literal notranslate"><span class="pre">algorithms.utils.pca</span></code><a class="headerlink" href="#module-nipy.algorithms.utils.pca" title="Permalink to this headline">¶</a></h2>
<p>This module provides a class for principal components analysis (PCA).</p>
<p>PCA is an orthonormal, linear transform (i.e., a rotation) that maps the
data to a new coordinate system such that the maximal variability of the
data lies on the first coordinate (or the first principal component), the
second greatest variability is projected onto the second coordinate, and
so on.  The resulting data has unit covariance (i.e., it is decorrelated).
This technique can be used to reduce the dimensionality of the data.</p>
<p>More specifically, the data is projected onto the eigenvectors of the
covariance matrix.</p>
</div>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="nipy.algorithms.utils.pca.pca">
<code class="sig-prename descclassname">nipy.algorithms.utils.pca.</code><code class="sig-name descname">pca</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">axis=0</em>, <em class="sig-param">mask=None</em>, <em class="sig-param">ncomp=None</em>, <em class="sig-param">standardize=True</em>, <em class="sig-param">design_keep=None</em>, <em class="sig-param">design_resid='mean'</em>, <em class="sig-param">tol_ratio=0.01</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/nipy/algorithms/utils/pca.html#pca"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#nipy.algorithms.utils.pca.pca" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the SVD PCA of an array-like thing over <cite>axis</cite>.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>data</strong> : ndarray-like (np.float)</p>
<blockquote>
<div><p>The array on which to perform PCA over axis <cite>axis</cite> (below)</p>
</div></blockquote>
<p><strong>axis</strong> : int, optional</p>
<blockquote>
<div><p>The axis over which to perform PCA (axis identifying
observations).  Default is 0 (first)</p>
</div></blockquote>
<p><strong>mask</strong> : ndarray-like (np.bool), optional</p>
<blockquote>
<div><p>An optional mask, should have shape given by data axes, with
<cite>axis</cite> removed, i.e.: <code class="docutils literal notranslate"><span class="pre">s</span> <span class="pre">=</span> <span class="pre">data.shape;</span> <span class="pre">s.pop(axis);</span>
<span class="pre">msk_shape=s</span></code></p>
</div></blockquote>
<p><strong>ncomp</strong> : {None, int}, optional</p>
<blockquote>
<div><p>How many component basis projections to return. If ncomp is None
(the default) then the number of components is given by the
calculated rank of the data, after applying <cite>design_keep</cite>,
<cite>design_resid</cite> and <cite>tol_ratio</cite> below.  We always return all the
basis vectors and percent variance for each component; <cite>ncomp</cite>
refers only to the number of basis_projections returned.</p>
</div></blockquote>
<p><strong>standardize</strong> : bool, optional</p>
<blockquote>
<div><p>If True, standardize so each time series (after application of
<cite>design_keep</cite> and <cite>design_resid</cite>) has the same standard
deviation, as calculated by the <code class="docutils literal notranslate"><span class="pre">np.std</span></code> function.</p>
</div></blockquote>
<p><strong>design_keep</strong> : None or ndarray, optional</p>
<blockquote>
<div><p>Data is projected onto the column span of design_keep.
None (default) equivalent to <code class="docutils literal notranslate"><span class="pre">np.identity(data.shape[axis])</span></code></p>
</div></blockquote>
<p><strong>design_resid</strong> : str or None or ndarray, optional</p>
<blockquote>
<div><p>After projecting onto the column span of design_keep, data is
projected perpendicular to the column span of this matrix.  If
None, we do no such second projection.  If a string ‘mean’, then
the mean of the data is removed, equivalent to passing a column
vector matrix of 1s.</p>
</div></blockquote>
<p><strong>tol_ratio</strong> : float, optional</p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">XZ</span></code> is the vector of singular values of the projection
matrix from <cite>design_keep</cite> and <cite>design_resid</cite>, and S are the
singular values of <code class="docutils literal notranslate"><span class="pre">XZ</span></code>, then <cite>tol_ratio</cite> is the value used to
calculate the effective rank of the projection of the design, as
in <code class="docutils literal notranslate"><span class="pre">rank</span> <span class="pre">=</span> <span class="pre">((S</span> <span class="pre">/</span> <span class="pre">S.max)</span> <span class="pre">&gt;</span> <span class="pre">tol_ratio).sum()</span></code></p>
</div></blockquote>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>results</strong> : dict</p>
<blockquote>
<div><blockquote>
<div><p><span class="math notranslate nohighlight">\(G\)</span> is the number of non-trivial components found after applying</p>
</div></blockquote>
<p><cite>tol_ratio</cite> to the projections of <cite>design_keep</cite> and
<cite>design_resid</cite>.</p>
<p><cite>results</cite> has keys:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">basis_vectors</span></code>: series over <cite>axis</cite>, shape (data.shape[axis], G) -</dt><dd><p>the eigenvectors of the PCA</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">pcnt_var</span></code>: percent variance explained by component, shape</dt><dd><p>(G,)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">basis_projections</span></code>: PCA components, with components varying</dt><dd><p>over axis <cite>axis</cite>; thus shape given by: <code class="docutils literal notranslate"><span class="pre">s</span> <span class="pre">=</span> <span class="pre">list(data.shape);</span>
<span class="pre">s[axis]</span> <span class="pre">=</span> <span class="pre">ncomp</span></code></p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">axis</span></code>: axis over which PCA has been performed.</p></li>
</ul>
</div></blockquote>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>See <code class="docutils literal notranslate"><span class="pre">pca_image.m</span></code> from <code class="docutils literal notranslate"><span class="pre">fmristat</span></code> for Keith Worsley’s code on
which some of this is based.</p>
<p>See: <a class="reference external" href="http://en.wikipedia.org/wiki/Principal_component_analysis">http://en.wikipedia.org/wiki/Principal_component_analysis</a> for
some inspiration for naming - particularly ‘basis_vectors’ and
‘basis_projections’</p>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">msk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">arr</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">pca</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">msk</span><span class="p">,</span> <span class="n">ncomp</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
</pre></div>
</div>
<p>Basis vectors are columns.  There is one column for each component.  The
number of components is the calculated rank of the data matrix after
applying the various projections listed in the parameters.  In this case we
are only removing the mean, so the number of components is one less than the
axis over which we do the PCA (here axis=0 by default).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;basis_vectors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(17, 16)</span>
</pre></div>
</div>
<p>Basis projections are arrays with components in the dimension over which we
have done the PCA (axis=0 by default).  Because we set <cite>ncomp</cite> above, we
only retain <cite>ncomp</cite> components.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;basis_projections&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(9, 10, 12, 14)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="nipy.algorithms.utils.pca.pca_image">
<code class="sig-prename descclassname">nipy.algorithms.utils.pca.</code><code class="sig-name descname">pca_image</code><span class="sig-paren">(</span><em class="sig-param">img</em>, <em class="sig-param">axis='t'</em>, <em class="sig-param">mask=None</em>, <em class="sig-param">ncomp=None</em>, <em class="sig-param">standardize=True</em>, <em class="sig-param">design_keep=None</em>, <em class="sig-param">design_resid='mean'</em>, <em class="sig-param">tol_ratio=0.01</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/nipy/algorithms/utils/pca.html#pca_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#nipy.algorithms.utils.pca.pca_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the PCA of an image over a specified axis</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>img</strong> : Image</p>
<blockquote>
<div><p>The image on which to perform PCA over the given <cite>axis</cite></p>
</div></blockquote>
<p><strong>axis</strong> : str or int, optional</p>
<blockquote>
<div><p>Axis over which to perform PCA. Default is ‘t’. If <cite>axis</cite> is an integer,
gives the index of the input (domain) axis of <cite>img</cite>. If <cite>axis</cite> is a str, can be
an input (domain) name, or an output (range) name, that maps to an input
(domain) name.</p>
</div></blockquote>
<p><strong>mask</strong> : Image, optional</p>
<blockquote>
<div><p>An optional mask, should have shape == image.shape[:3] and the same
coordinate map as <cite>img</cite> but with <cite>axis</cite> dropped</p>
</div></blockquote>
<p><strong>ncomp</strong> : {None, int}, optional</p>
<blockquote>
<div><p>How many component basis projections to return. If ncomp is None
(the default) then the number of components is given by the
calculated rank of the data, after applying <cite>design_keep</cite>,
<cite>design_resid</cite> and <cite>tol_ratio</cite> below.  We always return all the
basis vectors and percent variance for each component; <cite>ncomp</cite>
refers only to the number of basis_projections returned.</p>
</div></blockquote>
<p><strong>standardize</strong> : bool, optional</p>
<blockquote>
<div><p>If True, standardize so each time series (after application of
<cite>design_keep</cite> and <cite>design_resid</cite>) has the same standard
deviation, as calculated by the <code class="docutils literal notranslate"><span class="pre">np.std</span></code> function.</p>
</div></blockquote>
<p><strong>design_keep</strong> : None or ndarray, optional</p>
<blockquote>
<div><p>Data is projected onto the column span of design_keep.
None (default) equivalent to <code class="docutils literal notranslate"><span class="pre">np.identity(data.shape[axis])</span></code></p>
</div></blockquote>
<p><strong>design_resid</strong> : str or None or ndarray, optional</p>
<blockquote>
<div><p>After projecting onto the column span of design_keep, data is
projected perpendicular to the column span of this matrix.  If
None, we do no such second projection.  If a string ‘mean’, then
the mean of the data is removed, equivalent to passing a column
vector matrix of 1s.</p>
</div></blockquote>
<p><strong>tol_ratio</strong> : float, optional</p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">XZ</span></code> is the vector of singular values of the projection
matrix from <cite>design_keep</cite> and <cite>design_resid</cite>, and S are the
singular values of <code class="docutils literal notranslate"><span class="pre">XZ</span></code>, then <cite>tol_ratio</cite> is the value used to
calculate the effective rank of the projection of the design, as
in <code class="docutils literal notranslate"><span class="pre">rank</span> <span class="pre">=</span> <span class="pre">((S</span> <span class="pre">/</span> <span class="pre">S.max)</span> <span class="pre">&gt;</span> <span class="pre">tol_ratio).sum()</span></code></p>
</div></blockquote>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>results</strong> : dict</p>
<blockquote>
<div><blockquote>
<div><p><span class="math notranslate nohighlight">\(L\)</span> is the number of non-trivial components found after applying</p>
</div></blockquote>
<p><cite>tol_ratio</cite> to the projections of <cite>design_keep</cite> and
<cite>design_resid</cite>.</p>
<p><cite>results</cite> has keys:
* <code class="docutils literal notranslate"><span class="pre">basis_vectors</span></code>: series over <cite>axis</cite>, shape (data.shape[axis], L) -</p>
<blockquote>
<div><p>the eigenvectors of the PCA</p>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">pcnt_var</span></code>: percent variance explained by component, shape</dt><dd><p>(L,)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">basis_projections</span></code>: PCA components, with components varying</dt><dd><p>over axis <cite>axis</cite>; thus shape given by: <code class="docutils literal notranslate"><span class="pre">s</span> <span class="pre">=</span> <span class="pre">list(data.shape);</span>
<span class="pre">s[axis]</span> <span class="pre">=</span> <span class="pre">ncomp</span></code></p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">axis</span></code>: axis over which PCA has been performed.</p></li>
</ul>
</div></blockquote>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nipy.testing</span> <span class="k">import</span> <span class="n">funcfile</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nipy</span> <span class="k">import</span> <span class="n">load_image</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">func_img</span> <span class="o">=</span> <span class="n">load_image</span><span class="p">(</span><span class="n">funcfile</span><span class="p">)</span>
</pre></div>
</div>
<p>Time is the fourth axis</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">func_img</span><span class="o">.</span><span class="n">coordmap</span><span class="o">.</span><span class="n">function_range</span>
<span class="go">CoordinateSystem(coord_names=(&#39;aligned-x=L-&gt;R&#39;, &#39;aligned-y=P-&gt;A&#39;, &#39;aligned-z=I-&gt;S&#39;, &#39;t&#39;), name=&#39;aligned&#39;, coord_dtype=float64)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">func_img</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(17, 21, 3, 20)</span>
</pre></div>
</div>
<p>Calculate the PCA over time, by default</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">pca_image</span><span class="p">(</span><span class="n">func_img</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;basis_projections&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coordmap</span><span class="o">.</span><span class="n">function_range</span>
<span class="go">CoordinateSystem(coord_names=(&#39;aligned-x=L-&gt;R&#39;, &#39;aligned-y=P-&gt;A&#39;, &#39;aligned-z=I-&gt;S&#39;, &#39;PCA components&#39;), name=&#39;aligned&#39;, coord_dtype=float64)</span>
</pre></div>
</div>
<p>The number of components is one less than the number of time points</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;basis_projections&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(17, 21, 3, 19)</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright J. Taylor and others
      <span class="lastupdated">
        Last updated on Sep 24, 2019.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>