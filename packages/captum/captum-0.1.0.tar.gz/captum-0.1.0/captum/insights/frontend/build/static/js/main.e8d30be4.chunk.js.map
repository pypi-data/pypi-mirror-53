{"version":3,"sources":["App.js","index.js"],"names":["cx","obj","Array","isArray","join","Object","keys","filter","k","Header","className","React","Component","Tooltip","props","label","FilterContainer","handleClassDelete","i","classes","state","slice","removed_class","splice","suggested_classes","concat","setState","handleClassAdd","added_class","t","id","handleInputChange","event","target","value","type","checked","name","handleSubmit","data","prediction","approximation_steps","map","fetchData","preventDefault","config","c","this","suggestedClasses","approximationSteps","ClassFilter","tags","autofocus","suggestions","handleDelete","handleAddition","minQueryLength","placeholder","Filter","onSubmit","onChange","Spinner","_","calcHSLFromScore","percentage","target_hsl","default_hsl","abs_percent","Math","abs","color","ImageFeature","src","base","modified","TextFeature","color_words","w","style","backgroundColor","toFixed","GeneralFeature","bars","percent","width_percent","width","Feature","Error","Contributions","feature_outputs","f","contribution","bar_height","height","LabelButton","onClick","e","onTargetClick","labelIndex","instance","btn","active","children","Visualization","loading","features","panel","predicted","p","index","active_index","score","actual","Visualizations","length","v","key","App","_fetchInit","fetch","then","r","json","filter_config","method","headers","body","JSON","stringify","response","callback","assign","ReactDOM","render","document","getElementById"],"mappings":"0SAKA,SAASA,EAAGC,GACV,OAAIC,MAAMC,QAAQF,GACTA,EAAIG,KAAK,KAEXC,OAAOC,KAAKL,GAChBM,OAAO,SAAAC,GAAC,QAAMP,EAAIO,KAClBJ,KAAK,K,IAGJK,E,iLAEF,OACE,4BAAQC,UAAU,UAChB,yBAAKA,UAAU,gBAAf,mBACA,yBAAKA,UAAU,eACb,4BACE,wBAAIA,UAAU,+CAAd,+B,GAPSC,IAAMC,WAiB3B,SAASC,EAAQC,GACf,OACE,yBAAKJ,UAAU,WACb,yBAAKA,UAAU,kBAAkBI,EAAMC,Q,IAKvCC,E,YACJ,WAAYF,GAAQ,IAAD,uBACjB,4CAAMA,KAWRG,kBAAoB,SAAAC,GAClB,IAAMC,EAAU,EAAKC,MAAMD,QAAQE,MAAM,GACnCC,EAAgBH,EAAQI,OAAOL,EAAG,GAClCM,EAAoB,GAAGC,OAC3B,EAAKL,MAAMI,kBACXF,GAEF,EAAKI,SAAS,CAAEP,UAASK,uBAnBR,EAsBnBG,eAAiB,SAAAC,GACf,IAAMT,EAAU,GAAGM,OAAO,EAAKL,MAAMD,QAASS,GACxCJ,EAAoB,EAAKJ,MAAMI,kBAAkBjB,OACrD,SAAAsB,GAAC,OAAIA,EAAEC,KAAOF,EAAYE,KAE5B,EAAKJ,SAAS,CAAEP,UAASK,uBA3BR,EA8BnBO,kBAAoB,SAAAC,GAClB,IAAMC,EAASD,EAAMC,OACfC,EAAwB,aAAhBD,EAAOE,KAAsBF,EAAOG,QAAUH,EAAOC,MAC7DG,EAAOJ,EAAOI,KACpB,EAAKX,SAAL,eACGW,EAAOH,KAnCO,EAuCnBI,aAAe,SAAAN,GACb,IAAMO,EAAO,CACXC,WAAY,EAAKpB,MAAMoB,WACvBC,oBAAqB,EAAKrB,MAAMqB,oBAChCtB,QAAS,EAAKC,MAAMD,QAAQuB,IAAI,SAAAxB,GAAC,OAAIA,EAAC,QAExC,EAAKJ,MAAM6B,UAAUJ,GACrBP,EAAMY,kBA5CN,IAAMpB,EAAoBV,EAAM+B,OAAOH,IAAI,SAACI,EAAG5B,GAAJ,MAAW,CAAEY,GAAIZ,EAAGmB,KAAMS,KAFpD,OAIjB,EAAK1B,MAAQ,CACXoB,WAAY,MACZC,oBAAqB,GACrBtB,QAAS,GACTK,kBAAmBA,GARJ,E,sEAkDjB,OACE,kBAAC,EAAD,CACEgB,WAAYO,KAAK3B,MAAMoB,WACvBrB,QAAS4B,KAAK3B,MAAMD,QACpB6B,iBAAkBD,KAAK3B,MAAMI,kBAC7ByB,mBAAoBF,KAAK3B,MAAMqB,oBAC/Bd,eAAgBoB,KAAKpB,eACrBV,kBAAmB8B,KAAK9B,kBACxBc,kBAAmBgB,KAAKhB,kBACxBO,aAAcS,KAAKT,mB,GA5DG3B,IAAMC,WAkE9BsC,E,iLAEF,OACE,kBAAC,IAAD,CACEC,KAAMJ,KAAKjC,MAAMK,QACjBiC,WAAW,EACXC,YAAaN,KAAKjC,MAAMkC,iBACxBM,aAAcP,KAAKjC,MAAMG,kBACzBsC,eAAgBR,KAAKjC,MAAMa,eAC3B6B,eAAgB,EAChBC,YAAY,yB,GAVM9C,IAAMC,WAgB1B8C,E,iLAEF,OACE,0BAAMC,SAAUZ,KAAKjC,MAAMwB,cACzB,yBAAK5B,UAAU,gBACb,yBAAKA,UAAU,wBACb,yBAAKA,UAAU,+BAAf,qBACA,yBAAKA,UAAU,8BACb,kBAAC,EAAD,CACEO,kBAAmB8B,KAAKjC,MAAMG,kBAC9BU,eAAgBoB,KAAKjC,MAAMa,eAC3BqB,iBAAkBD,KAAKjC,MAAMkC,iBAC7B7B,QAAS4B,KAAKjC,MAAMK,YAI1B,yBAAKT,UAAU,wBACb,yBAAKA,UAAU,+BAAf,uBAGA,yBAAKA,UAAU,8BAAf,cACc,IACZ,4BACEA,UAAU,SACV2B,KAAK,aACLuB,SAAUb,KAAKjC,MAAMiB,kBACrBG,MAAOa,KAAKjC,MAAM0B,YAElB,4BAAQN,MAAM,OAAd,OACA,4BAAQA,MAAM,WAAd,WACA,4BAAQA,MAAM,aAAd,gBAIN,yBAAKxB,UAAU,wBACb,yBAAKA,UAAU,+BAAf,wBAGA,yBAAKA,UAAU,8BAAf,uBACuB,IACrB,2BACEA,UAAU,sBACV2B,KAAK,sBACLF,KAAK,SACLD,MAAOa,KAAKjC,MAAMmC,mBAClBW,SAAUb,KAAKjC,MAAMiB,sBAI3B,yBAAKrB,UAAU,kDACb,4BAAQA,UAAU,+BAAlB,gB,GAlDSC,IAAMC,WA0D3B,SAASiD,EAAQC,GACf,OAAO,yBAAKpD,UAAU,YAGxB,SAASqD,EAAiBC,GAAkC,IAItDC,EAAa,KAEfA,EADED,EAAa,EAJA,CAAC,IAAK,IAAK,IACZ,CAAC,GAAI,IAAK,IAS1B,IAAME,EAAc,CAAC,EAAG,GAXiC,wDAWf,IAAM,IAC1CC,EAAcC,KAAKC,IAAiB,IAAbL,GAC7B,GAAIG,EAAc,IAChB,OAAOD,EAGT,IAAMI,EAAQ,CACZL,EAAW,IACVA,EAAW,GAAKC,EAAY,IAAMC,EAAcD,EAAY,IAC5DD,EAAW,GAAKC,EAAY,IAAMC,EAAcD,EAAY,IAE/D,MAAM,OAAN,OAAcI,EAAM,GAApB,aAA2BA,EAAM,GAAjC,cAAyCA,EAAM,GAA/C,MAGF,SAASC,EAAazD,GACpB,OACE,oCACE,yBAAKJ,UAAU,wBAAwBI,EAAMyB,KAAKF,KAAlD,YACA,yBAAK3B,UAAU,uBACb,yBAAKA,UAAU,WACb,yBAAKA,UAAU,iBACb,yBAAKA,UAAU,wBACb,yBAAK8D,IAAK,yBAA2B1D,EAAMyB,KAAKkC,QAElD,yBAAK/D,UAAU,8BAAf,aAEF,yBAAKA,UAAU,iBACb,yBAAKA,UAAU,wBACb,yBAAK8D,IAAK,yBAA2B1D,EAAMyB,KAAKmC,YAElD,yBAAKhE,UAAU,8BAAf,6BAUZ,SAASiE,EAAY7D,GACnB,IAAM8D,EAAc9D,EAAMyB,KAAKkC,KAAK/B,IAAI,SAACmC,EAAG3D,GAC1C,OACE,oCACE,0BACE4D,MAAO,CACLC,gBAAiBhB,EAAiBjD,EAAMyB,KAAKmC,SAASxD,IAAI,IAE5DR,UAAW,qBAEVmE,EACD,kBAAChE,EAAD,CAASE,MAAOD,EAAMyB,KAAKmC,SAASxD,GAAG8D,QAAQ,MACzC,OAId,OACE,oCACE,yBAAKtE,UAAU,wBAAwBI,EAAMyB,KAAKF,KAAlD,WACA,yBAAK3B,UAAU,uBAAuBkE,IAK5C,SAASK,EAAenE,GACtB,IAAMoE,EAAOpE,EAAMyB,KAAKkC,KAAK/B,IAAI,SAACmC,EAAG3D,GACnC,IAAMiE,EAAUrE,EAAMyB,KAAKmC,SAASxD,GAAG8D,QAAQ,GACzCV,EACJ,0BAA4Ba,EAAU,EAAI,WAAa,YACnDC,EAAgBhB,KAAKC,IAAIc,GAAW,IAC1C,OACE,yBAAKzE,UAAU,mBACb,0BAAMA,UAAU,oCACd,0BAAMA,UAAU,0BAA0BmE,GAC1C,0BAAMnE,UAAU,4BAA4ByE,IAE9C,yBAAKzE,UAAU,kCACb,0BACEA,UAAWV,EAAG,CAAC,uBAAwBsE,IACvCQ,MAAO,CAAEO,MAAOD,SAM1B,OACE,oCACE,yBAAK1E,UAAU,wBAAwBI,EAAMyB,KAAKF,KAAlD,cACA,yBAAK3B,UAAU,uBAAuBwE,IAK5C,SAASI,EAAQxE,GACf,IAAMyB,EAAOzB,EAAMyB,KACnB,OAAQA,EAAKJ,MACX,IAAK,QACH,OAAO,kBAACoC,EAAD,CAAchC,KAAMA,IAC7B,IAAK,OACH,OAAO,kBAACoC,EAAD,CAAapC,KAAMA,IAC5B,IAAK,UACH,OAAO,kBAAC0C,EAAD,CAAgB1C,KAAMA,IAC/B,QACE,MAAM,IAAIgD,MAAM,2CAA6ChD,EAAKJ,O,IAIlEqD,E,iLAEF,OAAOzC,KAAKjC,MAAM2E,gBAAgB/C,IAAI,SAAAgD,GAGpC,IAAMC,EAAgC,IAAjBD,EAAEC,aACjBC,EAAaD,EAAe,GAAKA,EAAeA,EAAe,GACrE,OACE,yBAAKjF,UAAU,oBACb,yBACEA,UAAW,wBACXoE,MAAO,CACLe,OAAQD,EAAa,KACrBb,gBAAiBhB,EAAiB4B,MAGtC,yBAAKjF,UAAU,2BAA2BgF,EAAErD,a,GAhB1B1B,IAAMC,WAuB5BkF,E,2MACJC,QAAU,SAAAC,GACRA,EAAEpD,iBACF,EAAK9B,MAAMmF,cAAc,EAAKnF,MAAMoF,WAAY,EAAKpF,MAAMqF,W,wEAI3D,OACE,4BACEJ,QAAShD,KAAKgD,QACdrF,UAAWV,EAAG,CACZoG,KAAK,EACL,aAAcrD,KAAKjC,MAAMuF,OACzB,gBAAiBtD,KAAKjC,MAAMuF,UAG7BtD,KAAKjC,MAAMwF,c,GAhBM3F,IAAMC,WAsB1B2F,E,YACJ,WAAYzF,GAAQ,IAAD,8BACjB,4CAAMA,KAMRmF,cAAgB,SAACC,EAAYC,GAC3B,EAAKzE,SAAS,CAAE8E,SAAS,IACzB,EAAK1F,MAAMmF,cAAcC,EAAYC,EAAU,kBAC7C,EAAKzE,SAAS,CAAE8E,SAAS,OAR3B,EAAKpF,MAAQ,CACXoF,SAAS,GAHM,E,sEAcT,IAAD,OACDjE,EAAOQ,KAAKjC,MAAMyB,KAClBkE,EAAWlE,EAAKkD,gBAAgB/C,IAAI,SAAAgD,GAAC,OAAI,kBAACJ,EAAD,CAAS/C,KAAMmD,MAE9D,OACE,oCACG3C,KAAK3B,MAAMoF,SACV,yBAAK9F,UAAU,WACb,kBAACmD,EAAD,OAGJ,yBACEnD,UAAWV,EAAG,CACZ0G,OAAO,EACP,eAAe,EACf,iBAAkB3D,KAAK3B,MAAMoF,WAG/B,yBAAK9F,UAAU,iBACb,yBAAKA,UAAU,wBAAf,aACA,yBAAKA,UAAU,uBACZ6B,EAAKoE,UAAUjE,IAAI,SAAAkE,GAAC,OACnB,yBAAKlG,UAAU,oBACb,kBAAC,EAAD,CACEuF,cAAe,EAAKA,cACpBC,WAAYU,EAAEC,MACdV,SAAU,EAAKrF,MAAMqF,SACrBE,OAAQO,EAAEC,QAAUtE,EAAKuE,cAExBF,EAAE7F,MANL,KAMc6F,EAAEG,MAAM/B,QAAQ,GAN9B,UAYR,yBAAKtE,UAAU,iBACb,yBAAKA,UAAU,wBAAf,SACA,yBAAKA,UAAU,uBACb,yBAAKA,UAAU,oBACb,kBAAC,EAAD,CACEuF,cAAelD,KAAKkD,cACpBC,WAAY3D,EAAKyE,OAAOH,MACxBV,SAAUpD,KAAKjC,MAAMqF,SACrBE,OAAQ9D,EAAKyE,OAAOH,QAAUtE,EAAKuE,cAElCvE,EAAKyE,OAAOjG,UAKrB,yBAAKL,UAAU,iBACb,yBAAKA,UAAU,wBAAf,gBACA,yBAAKA,UAAU,uBACb,yBAAKA,UAAU,aACb,kBAAC,EAAD,CAAe+E,gBAAiBlD,EAAKkD,qBAI3C,yBAAK/E,UAAU,wCAAwC+F,S,GAzErC9F,IAAMC,WAgFlC,SAASqG,EAAenG,GACtB,OAAIA,EAAM0F,QAEN,yBAAK9F,UAAU,OACb,yBAAKA,UAAU,uBACb,kBAACmD,EAAD,QAMH/C,EAAMyB,MAA8B,IAAtBzB,EAAMyB,KAAK2E,OAa5B,yBAAKxG,UAAU,OACZI,EAAMyB,KAAKG,IAAI,SAACyE,EAAGjG,GAAJ,OACd,kBAAC,EAAD,CACEqB,KAAM4E,EACNhB,SAAUjF,EACVkG,IAAKlG,EACL+E,cAAenF,EAAMmF,mBAjBzB,yBAAKvF,UAAU,OACb,yBAAKA,UAAU,SACb,yBAAKA,UAAU,iBAAf,gBACe,4BAAQA,UAAU,qBAAlB,SADf,6B,IAwFK2G,E,YAjEb,WAAYvG,GAAQ,IAAD,8BACjB,4CAAMA,KASRwG,WAAa,WACXC,MAAM,SACHC,KAAK,SAAAC,GAAC,OAAIA,EAAEC,SACZF,KAAK,SAAAC,GAAC,OAAI,EAAK/F,SAAS,CAAEmB,OAAQ4E,OAbpB,EAgBnB9E,UAAY,SAAAgF,GACV,EAAKjG,SAAS,CAAE8E,SAAS,IACzBe,MAAM,SAAU,CACdK,OAAQ,OACRC,QAAS,CACP,eAAgB,oBAElBC,KAAMC,KAAKC,UAAUL,KAEpBH,KAAK,SAAAS,GAAQ,OAAIA,EAASP,SAC1BF,KAAK,SAAAS,GAAQ,OAAI,EAAKvG,SAAS,CAAEa,KAAM0F,EAAUzB,SAAS,OA1B5C,EA6BnBP,cAAgB,SAACC,EAAYC,EAAU+B,GACrCX,MAAM,aAAc,CAClBK,OAAQ,OACRC,QAAS,CACP,eAAgB,oBAElBC,KAAMC,KAAKC,UAAU,CAAE9B,aAAYC,eAElCqB,KAAK,SAAAS,GAAQ,OAAIA,EAASP,SAC1BF,KAAK,SAAAS,GACJ,IAAM1F,EAAOlC,OAAO8H,OAAO,GAAI,EAAK/G,MAAMmB,MAC1CA,EAAK4D,GAAY8B,EACjB,EAAKvG,SAAS,CAAEa,SAChB2F,OAxCJ,EAAK9G,MAAQ,CACXmB,KAAM,GACNM,OAAQ,GACR2D,SAAS,GAEX,EAAKc,aAPY,E,sEA+CjB,OACE,yBAAK5G,UAAU,OACb,kBAAC,EAAD,MACA,kBAAC,EAAD,CACEiC,UAAWI,KAAKJ,UAChBE,OAAQE,KAAK3B,MAAMyB,OACnBuE,IAAKrE,KAAK3B,MAAMyB,SAElB,kBAACoE,EAAD,CACE1E,KAAMQ,KAAK3B,MAAMmB,KACjBiE,QAASzD,KAAK3B,MAAMoF,QACpBP,cAAelD,KAAKkD,qB,GA3DZtF,IAAMC,WC1cxBwH,IAASC,OAAO,kBAAC,EAAD,MAASC,SAASC,eAAe,W","file":"static/js/main.e8d30be4.chunk.js","sourcesContent":["import React from \"react\";\nimport ReactTags from \"react-tag-autocomplete\";\nimport \"./App.css\";\n\n// helper method to convert an array or object into a valid classname\nfunction cx(obj) {\n  if (Array.isArray(obj)) {\n    return obj.join(\" \");\n  }\n  return Object.keys(obj)\n    .filter(k => !!obj[k])\n    .join(\" \");\n}\n\nclass Header extends React.Component {\n  render() {\n    return (\n      <header className=\"header\">\n        <div className=\"header__name\">Captum Insights</div>\n        <nav className=\"header__nav\">\n          <ul>\n            <li className=\"header__nav__item header__nav__item--active\">\n              Instance Attribution\n            </li>\n          </ul>\n        </nav>\n      </header>\n    );\n  }\n}\n\nfunction Tooltip(props) {\n  return (\n    <div className=\"tooltip\">\n      <div className=\"tooltip__label\">{props.label}</div>\n    </div>\n  );\n}\n\nclass FilterContainer extends React.Component {\n  constructor(props) {\n    super(props);\n    const suggested_classes = props.config.map((c, i) => ({ id: i, name: c }));\n\n    this.state = {\n      prediction: \"all\",\n      approximation_steps: 20,\n      classes: [],\n      suggested_classes: suggested_classes\n    };\n  }\n\n  handleClassDelete = i => {\n    const classes = this.state.classes.slice(0);\n    const removed_class = classes.splice(i, 1);\n    const suggested_classes = [].concat(\n      this.state.suggested_classes,\n      removed_class\n    );\n    this.setState({ classes, suggested_classes });\n  };\n\n  handleClassAdd = added_class => {\n    const classes = [].concat(this.state.classes, added_class);\n    const suggested_classes = this.state.suggested_classes.filter(\n      t => t.id !== added_class.id\n    );\n    this.setState({ classes, suggested_classes });\n  };\n\n  handleInputChange = event => {\n    const target = event.target;\n    const value = target.type === \"checkbox\" ? target.checked : target.value;\n    const name = target.name;\n    this.setState({\n      [name]: value\n    });\n  };\n\n  handleSubmit = event => {\n    const data = {\n      prediction: this.state.prediction,\n      approximation_steps: this.state.approximation_steps,\n      classes: this.state.classes.map(i => i[\"name\"])\n    };\n    this.props.fetchData(data);\n    event.preventDefault();\n  };\n\n  render() {\n    return (\n      <Filter\n        prediction={this.state.prediction}\n        classes={this.state.classes}\n        suggestedClasses={this.state.suggested_classes}\n        approximationSteps={this.state.approximation_steps}\n        handleClassAdd={this.handleClassAdd}\n        handleClassDelete={this.handleClassDelete}\n        handleInputChange={this.handleInputChange}\n        handleSubmit={this.handleSubmit}\n      />\n    );\n  }\n}\n\nclass ClassFilter extends React.Component {\n  render() {\n    return (\n      <ReactTags\n        tags={this.props.classes}\n        autofocus={false}\n        suggestions={this.props.suggestedClasses}\n        handleDelete={this.props.handleClassDelete}\n        handleAddition={this.props.handleClassAdd}\n        minQueryLength={0}\n        placeholder=\"add new class...\"\n      />\n    );\n  }\n}\n\nclass Filter extends React.Component {\n  render() {\n    return (\n      <form onSubmit={this.props.handleSubmit}>\n        <div className=\"filter-panel\">\n          <div className=\"filter-panel__column\">\n            <div className=\"filter-panel__column__title\">Filter by Classes</div>\n            <div className=\"filter-panel__column__body\">\n              <ClassFilter\n                handleClassDelete={this.props.handleClassDelete}\n                handleClassAdd={this.props.handleClassAdd}\n                suggestedClasses={this.props.suggestedClasses}\n                classes={this.props.classes}\n              />\n            </div>\n          </div>\n          <div className=\"filter-panel__column\">\n            <div className=\"filter-panel__column__title\">\n              Filter by Instances\n            </div>\n            <div className=\"filter-panel__column__body\">\n              Prediction:{\" \"}\n              <select\n                className=\"select\"\n                name=\"prediction\"\n                onChange={this.props.handleInputChange}\n                value={this.props.prediction}\n              >\n                <option value=\"all\">All</option>\n                <option value=\"correct\">Correct</option>\n                <option value=\"incorrect\">Incorrect</option>\n              </select>\n            </div>\n          </div>\n          <div className=\"filter-panel__column\">\n            <div className=\"filter-panel__column__title\">\n              Integrated Gradients\n            </div>\n            <div className=\"filter-panel__column__body\">\n              Approximation steps:{\" \"}\n              <input\n                className=\"input input--narrow\"\n                name=\"approximation_steps\"\n                type=\"number\"\n                value={this.props.approximationSteps}\n                onChange={this.props.handleInputChange}\n              />\n            </div>\n          </div>\n          <div className=\"filter-panel__column filter-panel__column--end\">\n            <button className=\"btn btn--outline btn--large\">Fetch</button>\n          </div>\n        </div>\n      </form>\n    );\n  }\n}\n\nfunction Spinner(_) {\n  return <div className=\"spinner\" />;\n}\n\nfunction calcHSLFromScore(percentage, zeroDefault = false) {\n  const blue_hsl = [220, 100, 80];\n  const red_hsl = [10, 100, 67];\n\n  let target_hsl = null;\n  if (percentage > 0) {\n    target_hsl = blue_hsl;\n  } else {\n    target_hsl = red_hsl;\n  }\n\n  const default_hsl = [0, 40, zeroDefault ? 100 : 90];\n  const abs_percent = Math.abs(percentage * 0.01);\n  if (abs_percent < 0.02) {\n    return default_hsl;\n  }\n\n  const color = [\n    target_hsl[0],\n    (target_hsl[1] - default_hsl[1]) * abs_percent + default_hsl[1],\n    (target_hsl[2] - default_hsl[2]) * abs_percent + default_hsl[2]\n  ];\n  return `hsl(${color[0]}, ${color[1]}%, ${color[2]}%)`;\n}\n\nfunction ImageFeature(props) {\n  return (\n    <>\n      <div className=\"panel__column__title\">{props.data.name} (Image)</div>\n      <div className=\"panel__column__body\">\n        <div className=\"gallery\">\n          <div className=\"gallery__item\">\n            <div className=\"gallery__item__image\">\n              <img src={\"data:image/png;base64,\" + props.data.base} />\n            </div>\n            <div className=\"gallery__item__description\">Original</div>\n          </div>\n          <div className=\"gallery__item\">\n            <div className=\"gallery__item__image\">\n              <img src={\"data:image/png;base64,\" + props.data.modified} />\n            </div>\n            <div className=\"gallery__item__description\">\n              Attribution Magnitude\n            </div>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n\nfunction TextFeature(props) {\n  const color_words = props.data.base.map((w, i) => {\n    return (\n      <>\n        <span\n          style={{\n            backgroundColor: calcHSLFromScore(props.data.modified[i], false)\n          }}\n          className={\"text-feature-word\"}\n        >\n          {w}\n          <Tooltip label={props.data.modified[i].toFixed(3)} />\n        </span>{\" \"}\n      </>\n    );\n  });\n  return (\n    <>\n      <div className=\"panel__column__title\">{props.data.name} (Text)</div>\n      <div className=\"panel__column__body\">{color_words}</div>\n    </>\n  );\n}\n\nfunction GeneralFeature(props) {\n  const bars = props.data.base.map((w, i) => {\n    const percent = props.data.modified[i].toFixed(3);\n    const color =\n      \"general-feature__bar__\" + (percent > 0 ? \"positive\" : \"negative\");\n    const width_percent = Math.abs(percent) + \"%\";\n    return (\n      <div className=\"general-feature\">\n        <span className=\"general-feature__label-container\">\n          <span className=\"general-feature__label\">{w}</span>\n          <span className=\"general-feature__percent\">{percent}</span>\n        </span>\n        <div className=\"general-feature__bar-container\">\n          <span\n            className={cx([\"general-feature__bar\", color])}\n            style={{ width: width_percent }}\n          ></span>\n        </div>\n      </div>\n    );\n  });\n  return (\n    <>\n      <div className=\"panel__column__title\">{props.data.name} (General)</div>\n      <div className=\"panel__column__body\">{bars}</div>\n    </>\n  );\n}\n\nfunction Feature(props) {\n  const data = props.data;\n  switch (data.type) {\n    case \"image\":\n      return <ImageFeature data={data} />;\n    case \"text\":\n      return <TextFeature data={data} />;\n    case \"general\":\n      return <GeneralFeature data={data} />;\n    default:\n      throw new Error(\"Unsupported feature visualization type: \" + data.type);\n  }\n}\n\nclass Contributions extends React.Component {\n  render() {\n    return this.props.feature_outputs.map(f => {\n      // pad bar height so features with 0 contribution can still be seen\n      // in graph\n      const contribution = f.contribution * 100;\n      const bar_height = contribution > 10 ? contribution : contribution + 10;\n      return (\n        <div className=\"bar-chart__group\">\n          <div\n            className={\"bar-chart__group__bar\"}\n            style={{\n              height: bar_height + \"px\",\n              backgroundColor: calcHSLFromScore(contribution)\n            }}\n          />\n          <div className=\"bar-chart__group__title\">{f.name}</div>\n        </div>\n      );\n    });\n  }\n}\n\nclass LabelButton extends React.Component {\n  onClick = e => {\n    e.preventDefault();\n    this.props.onTargetClick(this.props.labelIndex, this.props.instance);\n  };\n\n  render() {\n    return (\n      <button\n        onClick={this.onClick}\n        className={cx({\n          btn: true,\n          \"btn--solid\": this.props.active,\n          \"btn--outline\": !this.props.active\n        })}\n      >\n        {this.props.children}\n      </button>\n    );\n  }\n}\n\nclass Visualization extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading: false\n    };\n  }\n\n  onTargetClick = (labelIndex, instance) => {\n    this.setState({ loading: true });\n    this.props.onTargetClick(labelIndex, instance, () =>\n      this.setState({ loading: false })\n    );\n  };\n\n  render() {\n    const data = this.props.data;\n    const features = data.feature_outputs.map(f => <Feature data={f} />);\n\n    return (\n      <>\n        {this.state.loading && (\n          <div className=\"loading\">\n            <Spinner />\n          </div>\n        )}\n        <div\n          className={cx({\n            panel: true,\n            \"panel--long\": true,\n            \"panel--loading\": this.state.loading\n          })}\n        >\n          <div className=\"panel__column\">\n            <div className=\"panel__column__title\">Predicted</div>\n            <div className=\"panel__column__body\">\n              {data.predicted.map(p => (\n                <div className=\"row row--padding\">\n                  <LabelButton\n                    onTargetClick={this.onTargetClick}\n                    labelIndex={p.index}\n                    instance={this.props.instance}\n                    active={p.index === data.active_index}\n                  >\n                    {p.label} ({p.score.toFixed(3)})\n                  </LabelButton>\n                </div>\n              ))}\n            </div>\n          </div>\n          <div className=\"panel__column\">\n            <div className=\"panel__column__title\">Label</div>\n            <div className=\"panel__column__body\">\n              <div className=\"row row--padding\">\n                <LabelButton\n                  onTargetClick={this.onTargetClick}\n                  labelIndex={data.actual.index}\n                  instance={this.props.instance}\n                  active={data.actual.index === data.active_index}\n                >\n                  {data.actual.label}\n                </LabelButton>\n              </div>\n            </div>\n          </div>\n          <div className=\"panel__column\">\n            <div className=\"panel__column__title\">Contribution</div>\n            <div className=\"panel__column__body\">\n              <div className=\"bar-chart\">\n                <Contributions feature_outputs={data.feature_outputs} />\n              </div>\n            </div>\n          </div>\n          <div className=\"panel__column panel__column--stretch\">{features}</div>\n        </div>\n      </>\n    );\n  }\n}\n\nfunction Visualizations(props) {\n  if (props.loading) {\n    return (\n      <div className=\"viz\">\n        <div className=\"panel panel--center\">\n          <Spinner />\n        </div>\n      </div>\n    );\n  }\n\n  if (!props.data || props.data.length === 0) {\n    return (\n      <div className=\"viz\">\n        <div className=\"panel\">\n          <div className=\"panel__column\">\n            Please press <strong className=\"text-feature-word\">Fetch</strong> to\n            start loading data.\n          </div>\n        </div>\n      </div>\n    );\n  }\n  return (\n    <div className=\"viz\">\n      {props.data.map((v, i) => (\n        <Visualization\n          data={v}\n          instance={i}\n          key={i}\n          onTargetClick={props.onTargetClick}\n        />\n      ))}\n    </div>\n  );\n}\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      data: [],\n      config: [],\n      loading: false\n    };\n    this._fetchInit();\n  }\n\n  _fetchInit = () => {\n    fetch(\"/init\")\n      .then(r => r.json())\n      .then(r => this.setState({ config: r }));\n  };\n\n  fetchData = filter_config => {\n    this.setState({ loading: true });\n    fetch(\"/fetch\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(filter_config)\n    })\n      .then(response => response.json())\n      .then(response => this.setState({ data: response, loading: false }));\n  };\n\n  onTargetClick = (labelIndex, instance, callback) => {\n    fetch(\"/attribute\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({ labelIndex, instance })\n    })\n      .then(response => response.json())\n      .then(response => {\n        const data = Object.assign([], this.state.data);\n        data[instance] = response;\n        this.setState({ data });\n        callback();\n      });\n  };\n\n  render() {\n    return (\n      <div className=\"app\">\n        <Header />\n        <FilterContainer\n          fetchData={this.fetchData}\n          config={this.state.config}\n          key={this.state.config}\n        />\n        <Visualizations\n          data={this.state.data}\n          loading={this.state.loading}\n          onTargetClick={this.onTargetClick}\n        />\n      </div>\n    );\n  }\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}